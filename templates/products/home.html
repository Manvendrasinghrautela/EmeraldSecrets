{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/products.css' %}">
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="hero-content">
        <h1>Welcome to Emerald Secrets</h1>
        <p>Discover our exquisite collection of gemstones and jewelry</p>
        <a href="{% url 'products:product_list' %}" class="btn btn-primary">Shop Now</a>
    </div>
</section>

<!-- Featured Products Section -->
<section class="products-section">
    <div class="section-header">
        <h2>Featured Collection</h2>
        <p>Hand-picked selections for you</p>
    </div>

    <div class="product-grid">
        {% for product in featured_products %}
        <div class="product-card">
            <div class="product-image">
                {% if product.main_image %}
                <img src="{{ product.main_image.url }}" alt="{{ product.name }}">
                {% else %}
                <img src="{% static 'images/placeholder.png' %}" alt="No image">
                {% endif %}
                
                {% if product.is_new %}
                <span class="product-badge new">New</span>
                {% elif product.discount_percent %}
                <span class="product-badge sale">-{{ product.discount_percent }}%</span>
                {% endif %}
                
                <button class="wishlist-btn" onclick="toggleWishlist({{ product.id }}, this)">
                    <i class="far fa-heart"></i>
                </button>
            </div>
            
            <div class="product-info">
                <p class="product-category">{{ product.category.name }}</p>
                <h3 class="product-name">
                    <a href="{% url 'products:product_detail' product.slug %}">{{ product.name }}</a>
                </h3>
                <div class="product-rating">
                    <span class="stars">★★★★★</span>
                    <span class="rating-count">({{ product.review_count|default:0 }} reviews)</span>
                </div>
                <div class="product-price">
                    <span class="current-price">₹{{ product.price }}</span>
                    {% if product.compare_at_price %}
                    <span class="original-price">₹{{ product.compare_at_price }}</span>
                    {% if product.discount_percentage %}
                    <span class="discount-percent">{{ product.discount_percentage }}% OFF</span>
                    {% endif %}
                    {% endif %}
                </div>
                <div class="product-actions">
                    <form method="post" action="{% url 'products:add_to_cart' product.id %}">
                        {% csrf_token %}
                        <input type="hidden" name="quantity" value="1">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-shopping-cart"></i> Add to Cart
                        </button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>

<!-- Featured Collections Section -->
{% if featured_collections %}
<section class="products-section">
    <div class="section-header">
        <h2>Shop by Collection</h2>
        <p>Browse our curated collections</p>
    </div>

    <div class="collection-grid">
        {% for collection in featured_collections %}
        <a href="{% url 'products:collection_detail' collection.slug %}" class="collection-card">
            {% if collection.image %}
            <img src="{{ collection.image.url }}" alt="{{ collection.name }}">
            {% else %}
            <img src="{% static 'images/placeholder.png' %}" alt="{{ collection.name }}">
            {% endif %}
            <div class="collection-info">
                <h3>{{ collection.name }}</h3>
                <p>Explore Collection</p>
            </div>
        </a>
        {% endfor %}
    </div>
</section>
{% endif %}

<!-- Newsletter Section -->
<section class="newsletter-section" style="background: linear-gradient(135deg, #2D5F3F 0%, #4A7C59 100%); color: white; padding: 4rem 2rem; text-align: center;">
    <div style="max-width: 600px; margin: 0 auto;">
        <h2 style="font-size: 2.5rem; margin-bottom: 1rem;">Join Our Newsletter</h2>
        <p style="font-size: 1.125rem; margin-bottom: 2rem; opacity: 0.9;">Get exclusive offers and updates</p>
        <form method="post" action="{% url 'products:newsletter_subscribe' %}" style="display: flex; gap: 1rem;">
            {% csrf_token %}
            <input type="email" name="email" placeholder="Enter your email" required style="flex: 1; padding: 1rem; border: none; border-radius: 8px;">
            <button type="submit" class="btn btn-white" style="background-color: white; color: #2D5F3F;">Subscribe</button>
        </form>
    </div>
</section>

<script>
function toggleWishlist(productId, button) {
    {% if user.is_authenticated %}
    fetch(`/products/wishlist/toggle/${productId}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'X-Requested-With': 'XMLHttpRequest',
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.added) {
            button.innerHTML = '<i class="fas fa-heart"></i>';
            button.classList.add('active');
        } else {
            button.innerHTML = '<i class="far fa-heart"></i>';
            button.classList.remove('active');
        }
        alert(data.message);
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred. Please try again.');
    });
    {% else %}
    window.location.href = "{% url 'accounts:login' %}?next={{ request.path }}";
    {% endif %}
}
</script>
{% endblock %}

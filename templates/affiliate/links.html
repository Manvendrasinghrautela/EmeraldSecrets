{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/affiliate.css' %}">
{% endblock %}

{% block content %}
<section class="affiliate-dashboard">
    <div class="page-header">
        <h1>Affiliate Links</h1>
        <p class="page-description">Create and manage your referral links for different products and campaigns</p>
    </div>

    <!-- Create New Link -->
    <div class="create-link-section">
        <h2>Create New Referral Link</h2>
        <form method="post" class="link-form">
            {% csrf_token %}
            
            <div class="form-row">
                <div class="form-group">
                    <label>Link Type</label>
                    <select name="link_type" id="linkType">
                        <option value="general">General Store Link</option>
                        <option value="product">Specific Product</option>
                        <option value="collection">Collection</option>
                    </select>
                </div>

                <div class="form-group" id="productSelect" style="display:none;">
                    <label>Select Product</label>
                    <select name="product_id">
                        <option value="">Choose a product...</option>
                        {% for product in products %}
                        <option value="{{ product.id }}">{{ product.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label>Custom Campaign Name (Optional)</label>
                <input type="text" name="campaign_name" placeholder="e.g., Instagram Bio, YouTube Description">
            </div>

            <button type="submit" class="btn btn-primary">Generate Link</button>
        </form>
    </div>

    <!-- Existing Links -->
    <div class="links-list-section">
        <h2>Your Referral Links</h2>

        <div class="links-grid">
            <!-- General Link -->
            <div class="link-card">
                <div class="link-header">
                    <div class="link-type-badge general">General</div>
                    <div class="link-stats">
                        <span><i class="fas fa-eye"></i> 1,234 clicks</span>
                        <span><i class="fas fa-shopping-cart"></i> 28 sales</span>
                    </div>
                </div>

                <div class="link-body">
                    <p class="link-name">Main Store Link</p>
                    <div class="link-url-box">
                        <input type="text" value="https://emeraldsecrets.com/ref/ABC123" readonly>
                        <button class="copy-btn" onclick="copyLink(this)">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <p class="link-created">Created: Oct 15, 2024</p>
                </div>

                <div class="link-actions">
                    <button class="btn-action btn-stats"><i class="fas fa-chart-line"></i> View Stats</button>
                    <button class="btn-action btn-delete"><i class="fas fa-trash"></i> Delete</button>
                </div>
            </div>

            <!-- Product Link -->
            <div class="link-card">
                <div class="link-header">
                    <div class="link-type-badge product">Product</div>
                    <div class="link-stats">
                        <span><i class="fas fa-eye"></i> 456 clicks</span>
                        <span><i class="fas fa-shopping-cart"></i> 12 sales</span>
                    </div>
                </div>

                <div class="link-body">
                    <p class="link-name">Pure Rose Water - Instagram</p>
                    <div class="link-url-box">
                        <input type="text" value="https://emeraldsecrets.com/products/rose-water/ref/ABC123" readonly>
                        <button class="copy-btn" onclick="copyLink(this)">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <p class="link-created">Created: Oct 20, 2024</p>
                </div>

                <div class="link-actions">
                    <button class="btn-action btn-stats"><i class="fas fa-chart-line"></i> View Stats</button>
                    <button class="btn-action btn-delete"><i class="fas fa-trash"></i> Delete</button>
                </div>
            </div>

            <!-- Collection Link -->
            <div class="link-card">
                <div class="link-header">
                    <div class="link-type-badge collection">Collection</div>
                    <div class="link-stats">
                        <span><i class="fas fa-eye"></i> 789 clicks</span>
                        <span><i class="fas fa-shopping-cart"></i> 18 sales</span>
                    </div>
                </div>

                <div class="link-body">
                    <p class="link-name">Face Care Collection - YouTube</p>
                    <div class="link-url-box">
                        <input type="text" value="https://emeraldsecrets.com/collections/face-care/ref/ABC123" readonly>
                        <button class="copy-btn" onclick="copyLink(this)">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <p class="link-created">Created: Nov 1, 2024</p>
                </div>

                <div class="link-actions">
                    <button class="btn-action btn-stats"><i class="fas fa-chart-line"></i> View Stats</button>
                    <button class="btn-action btn-delete"><i class="fas fa-trash"></i> Delete</button>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
// Show/hide product select based on link type
document.getElementById('linkType').addEventListener('change', function() {
    const productSelect = document.getElementById('productSelect');
    if (this.value === 'product') {
        productSelect.style.display = 'block';
    } else {
        productSelect.style.display = 'none';
    }
});

// Copy link to clipboard
function copyLink(button) {
    const input = button.previousElementSibling;
    input.select();
    document.execCommand('copy');
    
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-check"></i>';
    setTimeout(() => {
        button.innerHTML = originalText;
    }, 2000);
}
</script>
{% endblock %}
